## 第十五章 目标代码生成及优化

代码生成模块，或称代码生成器需要面向某一个特定的目标体系结构生成目标代码。目标体系可以是某种微处理器体系结构，例如X86、MIPS、ARM等，也可以是某种被精心设计和定义的虚拟机（virtual machine)或运行时系统（runtime system)，如Java虚拟机，C#运行时系统（common language runtime）以及此前介绍过的P-code虚拟机。

### 15.1 微处理器体系结构简介

#### 15.1.1 指令集架构

- Stack栈式
- Accumulator累加式
- Register-Memory寄存器-内存式
- Register-Register/Load-Store寄存器-寄存器（或称读-取式）

#### 15.1.2 存储层次架构

- 由于寄存器的访问速度是最快的，从理论上希望程序尽可能少的访问除寄存器之外的任何一级存储设备
- 尽管缓存的调度和管理是由硬件完成的，编译器仍然可以通过改变堆数据结构的访问模式、大型数据结构的空间分配模式，以及插入数据预取指令等方式，影响缓存的利用效率

#### 15.1.3 流水线

- 流水线对提升单处理器核心的执行效率是非常明显的。

### 15.2 地址空间

一个正在运行的程序的地址空间会被划分为4个不同的区域：

- 代码区。存放目标代码。
- 静态数据区。
- 动态内存区。也被称为内存堆（heap）。程序在运行过程中，如对象、指针、动态数组等数据结构，需要动态申请和释放他们的内存空间。
- 程序运行栈。程序运行栈除了用来放置函数的活动记录，还记录了函数调用的上下文现场，其中包括：
  - 为了保证被调用函数返回后，程序仍能正确运行而由调用方保存的一些临时寄存器（scratch register/caller-saved register）和临时变量值
  - 被调用方保存的一些全局寄存器（global register）